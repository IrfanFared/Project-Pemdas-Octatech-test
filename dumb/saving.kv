#:import dp kivy.metrics.dp
#:import CircleProgress circle_progress.CircleProgress

BoxLayout:
    orientation: "vertical"
    padding: dp(20)

    ScrollView:
        do_scroll_y: True

        MDBoxLayout:
            orientation: "vertical"
            size_hint_y: None
            height: self.minimum_height
            spacing: dp(20)

            MDCard:
                radius: [20,]
                padding: dp(20)
                size_hint_y: None
                height: dp(520)

                BoxLayout:
                    orientation: "vertical"
                    spacing: dp(16)

                    # HEADER
                    BoxLayout:
                        size_hint_y: None
                        height: dp(60)
                        spacing: dp(10)

                        MDIcon:
                            icon: "piggy-bank"
                            font_size: "36sp"
                            theme_text_color: "Custom"
                            text_color: app.primary_color

                        BoxLayout:
                            orientation: "vertical"

                            MDLabel:
                                text: app.goal_name
                                font_size: "22sp"
                                bold: True

                            MDLabel:
                                text: "Target: " + app.format_rupiah(app.target_amount)
                                font_size: "13sp"
                                theme_text_color: "Secondary"

                        MDIconButton:
                            icon: "pencil"
                            on_release: app.open_edit_dialog()

                    # CIRCLE PROGRESS
                    AnchorLayout:
                        size_hint_y: None
                        height: dp(200)
                        CircleProgress:
                            id: circ
                            size_hint: None, None
                            size: dp(180), dp(180)
                            value: app.progress_value

                    MDLabel:
                        text: f"{app.progress_value:.1f}% Complete"
                        halign: "center"
                        font_size: "18sp"

                    # Horizontal progress
                    Widget:
                        size_hint_y: None
                        height: dp(10)
                        canvas:
                            Color:
                                rgba: 0.9, 0.9, 0.9, 1
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [5,]

                            Color:
                                rgba: 0.56, 0.35, 0.86, 1
                            RoundedRectangle:
                                pos: self.pos
                                size: (self.width * app.progress_value / 100, self.height)
                                radius: [5,]

                    # Sudah / Sisa
                    BoxLayout:
                        MDLabel:
                            text: "Sudah: " + app.format_rupiah(app.current_amount)
                            font_size: "16sp"

                        MDLabel:
                            text: "Sisa: " + app.format_rupiah(app.remaining_amount)
                            font_size: "16sp"

                    # Input Tabung
                    BoxLayout:
                        size_hint_y: None
                        height: dp(50)
                        spacing: dp(10)

                        MDTextField:
                            id: deposit_input
                            hint_text: "Nominal"
                            mode: "rectangle"

                        MDButton:
                            text: "Tambah"
                            on_release: app.handle_deposit_from_input()

                    # Quick Buttons
                    ScrollView:
                        do_scroll_x: True
                        do_scroll_y: False

                        MDBoxLayout:
                            id: quick_btns
                            orientation: "horizontal"
                            spacing: dp(10)
                            adaptive_height: True

                    # Action Buttons
                    BoxLayout:
                        size_hint_y: None
                        height: dp(50)
                        spacing: dp(10)

                        MDButton:
                            text: "Withdraw"
                            on_release: app.handle_withdraw()

                        MDButton:
                            text: "Reset"
                            on_release: app.handle_reset()

            # HISTORY CARD
            MDCard:
                padding: dp(20)
                radius: [20,]
                size_hint_y: None
                height: dp(350)

                BoxLayout:
                    orientation: "vertical"
                    spacing: dp(12)

                    MDLabel:
                        text: "Riwayat"
                        font_size: "18sp"
                        bold: True

                    ScrollView:
                        MDList:
                            id: history_list
